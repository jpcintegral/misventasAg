<h3>Ventas</h3>

<div class="table-actions">
  <button mat-raised-button color="primary" routerLink="/ventas/new">Nueva Venta</button>
  
  <button mat-raised-button color="primary" routerLink="/surtido/new">Pedido vendedor</button>


</div>

<div class="table-responsive">
  <table mat-table [dataSource]="ventas" class="mat-elevation-z8">

    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>Estatus</th>
      <td mat-cell *matCellDef="let v"
          [ngClass]="{
            'estado-pendiente': v.estado === 'PENDIENTE',
            'estado-cancelado': v.estado === 'CANCELADO',
            'estado-parcial': v.estado === 'PARCIAL',
            'estado-pagado': v.estado === 'PAGADO'
          }">
        {{ v.estado }}
      </td>
    </ng-container>
    <ng-container matColumnDef="tipoventa">
      <th mat-header-cell *matHeaderCellDef>Tipo venta</th>
      <td mat-cell *matCellDef="let v">{{ v.vendedor ? "vendedor:"+v.vendedor.nombre : "venta directa" }}</td>
    </ng-container>
     
    <ng-container matColumnDef="codigo">
      <th mat-header-cell *matHeaderCellDef>Código de venta</th>
      <td mat-cell *matCellDef="let v">{{ v.codigo }}</td>
    </ng-container>

    <ng-container matColumnDef="fecha">
      <th mat-header-cell *matHeaderCellDef>Fecha</th>
      <td mat-cell *matCellDef="let v">{{ v.fecha | date:'short' }}</td>
    </ng-container>

    

    <ng-container matColumnDef="total">
      <th mat-header-cell *matHeaderCellDef>Total</th>
      <td mat-cell *matCellDef="let v">{{ v.total | currency }}</td>
    </ng-container>

    <ng-container matColumnDef="acciones">
      <th mat-header-cell *matHeaderCellDef>Acciones</th>
      
     <td mat-cell *matCellDef="let v">
  <!-- Cancelar venta: solo si no está pagada -->
  <button mat-stroked-button color="warn" (click)="cancelarVenta(v)" 
          *ngIf="v.estado !== 'PAGADO' && v.estado !== 'CANCELADO'" 
          class="btn-small">
    Cancelar
  </button>

  <!-- Eliminar venta -->
  <button mat-stroked-button color="warn" (click)="deleteSale(v)" class="btn-small">
    Eliminar
  </button>

  <!-- Ver detalle -->
  <button mat-stroked-button color="primary" (click)="detail(v)" class="btn-small">
    Ver
  </button>
</td>

    </ng-container>

    <tr mat-header-row *matHeaderRowDef="columns"></tr>
    <tr mat-row *matRowDef="let row; columns: columns"></tr>

  </table>
</div>
